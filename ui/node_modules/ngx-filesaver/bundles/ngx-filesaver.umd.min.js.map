{"version":3,"sources":["../../lib/src/filesaver.service.ts","../../lib/src/filesaver.directive.ts","../../lib/src/filesaver.module.ts"],"names":["FileSaverService","Object","defineProperty","prototype","Blob","e","genType","fileName","lastIndexOf","type","substr","save","blob","filtType","option","Error","file","this","saveAs","decodeURI","saveText","txt","Injectable","args","providedIn","FileSaverDirective","el","fss","httpClient","method","success","EventEmitter","error","isFileSaverSupported","nativeElement","classList","add","getName","res","headers","get","_click","_this","req","http","params","HttpParams","query","item","set","request","url","observe","responseType","header","setDisabled","subscribe","status","body","size","emit","fsOptions","err","disabled","Directive","selector","exportAs","ElementRef","HttpClient","Input","Output","HostListener","NgModule","declarations","exports"],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { saveAs, FileSaverOptions } from 'file-saver';\n\n@Injectable({ providedIn: 'root' })\nexport class FileSaverService {\n  get isFileSaverSupported(): boolean {\n    try {\n      return !!new Blob();\n    } catch (e) {\n      return false;\n    }\n  }\n\n  genType(fileName?: string): string {\n    if (!fileName || fileName.lastIndexOf('.') === -1) {\n      return 'text/plain';\n    }\n    const type = fileName.substr(fileName.lastIndexOf('.') + 1);\n    switch (type) {\n      case 'txt':\n        return 'text/plain';\n      case 'xml':\n      case 'html':\n        return `text/${type}`;\n      case 'json':\n        return 'octet/stream';\n      default:\n        return `application/${type}`;\n    }\n  }\n\n  save(blob: Blob, fileName?: string, filtType?: string, option?: FileSaverOptions): void {\n    if (!blob) {\n      throw new Error('Data argument should be a blob instance');\n    }\n\n    const file = new Blob([blob], { type: filtType || blob.type || this.genType(fileName) });\n    saveAs(file, decodeURI(fileName || 'download'), option);\n  }\n\n  saveText(txt: string, fileName?: string, option?: FileSaverOptions): void {\n    const blob = new Blob([txt]);\n    this.save(blob, fileName, null, option);\n  }\n}\n","import { Directive, ElementRef, Input, HostListener, EventEmitter, Output } from '@angular/core';\nimport { HttpClient, HttpParams, HttpResponse } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { FileSaverOptions } from 'file-saver';\nimport { FileSaverService } from './filesaver.service';\n\n@Directive({\n  selector: '[fileSaver]',\n  exportAs: 'fileSaver',\n})\nexport class FileSaverDirective {\n  @Input() method = 'GET';\n  @Input() http: Observable<HttpResponse<Blob>>;\n  @Input() query: any;\n  @Input() header: any;\n  @Input() url: string;\n  @Input() fileName: string;\n  @Input() fsOptions: FileSaverOptions;\n  @Output() readonly success = new EventEmitter<HttpResponse<Blob>>();\n  @Output() readonly error = new EventEmitter<any>();\n\n  constructor(private el: ElementRef<HTMLButtonElement>, private fss: FileSaverService, private httpClient: HttpClient) {\n    if (!fss.isFileSaverSupported) {\n      el.nativeElement.classList.add(`filesaver__not-support`);\n    }\n  }\n\n  private getName(res: HttpResponse<Blob>) {\n    return decodeURI(this.fileName || res.headers.get('filename') || res.headers.get('x-filename'));\n  }\n\n  @HostListener('click')\n  _click() {\n    if (!this.fss.isFileSaverSupported) {\n      return;\n    }\n    let req = this.http;\n    if (!req) {\n      const params = new HttpParams();\n      const query = this.query || {};\n      // tslint:disable-next-line:forin\n      for (const item in query) {\n        params.set(item, query[item]);\n      }\n\n      req = this.httpClient.request(this.method, this.url, {\n        observe: 'response',\n        responseType: 'blob',\n        headers: this.header,\n        params,\n      });\n    }\n\n    this.setDisabled(true);\n    req.subscribe(\n      res => {\n        if (res.status !== 200 || res.body.size <= 0) {\n          this.error.emit(res);\n          return;\n        }\n        this.fss.save(res.body, this.getName(res), null, this.fsOptions);\n        this.success.emit(res);\n      },\n      err => this.error.emit(err),\n      () => this.setDisabled(false),\n    );\n  }\n\n  private setDisabled(status: boolean) {\n    const el = this.el.nativeElement;\n    el.disabled = status;\n    el.classList[status ? 'add' : 'remove'](`filesaver__disabled`);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { FileSaverDirective } from './filesaver.directive';\n\n@NgModule({\n  declarations: [FileSaverDirective],\n  exports: [FileSaverDirective],\n})\nexport class FileSaverModule {}\n"]}